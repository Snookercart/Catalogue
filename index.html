<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flipbook Zoom Native</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #fff;
      overflow: hidden;
    }

    :root {
      --vh: 1vh;
    }

    body {
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      touch-action: none;
    }

    #book {
      position: relative;
      width: 100vw;
      height: calc(var(--vh, 1vh) * 100);
      perspective: 2000px;
      transition: all 0.5s ease;
    }

    #book.normal {
      width: 90vw;
      max-width: 1000px;
      height: 90vh;
    }

    .page {
      position: absolute;
      width: 100%;
      height: 100%;
      background: white;
      transform-origin: left center;
      transform-style: preserve-3d;
      transition: transform 1s ease;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      overflow: hidden;
    }

    .page.flipped {
      transform: rotateY(-180deg);
    }

    .page-inner {
      width: 100%;
      height: 100%;
      overflow: hidden;
      touch-action: none;
      transform-origin: center center;
    }

    .page-inner img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      display: block;
      transform-origin: center center;
      transition: transform 0.3s ease;
      user-select: none;
      -webkit-user-drag: none;
      pointer-events: none;
    }

    .nav {
      position: absolute;
      top: 0;
      width: 50%;
      height: 100%;
      z-index: 100;
    }

    .nav.left { left: 0; }
    .nav.right { right: 0; }

    .controls {
      position: fixed;
      bottom: 12px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 200;
    }

    .btn {
      padding: 8px 14px;
      border: none;
      background: rgba(0,0,0,0.7);
      color: #fff;
      font-size: 14px;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div id="book" class="normal"></div>
<div class="nav left"></div>
<div class="nav right"></div>

<div class="controls">
  <button class="btn" id="toggleView">Enter Fullscreen</button>
</div>

<script>
  const totalPages = 10;
  const book = document.getElementById("book");
  const toggleBtn = document.getElementById("toggleView");
  let current = 0;

  // Generate pages
  for (let i = 1; i <= totalPages; i++) {
    const page = document.createElement("div");
    page.className = "page";
    page.style.zIndex = totalPages - i + 1;

    const inner = document.createElement("div");
    inner.className = "page-inner";

    const img = document.createElement("img");
    img.src = `page_${String(i).padStart(3, "0")}.png`;
    img.alt = `Page ${i}`;
    inner.appendChild(img);

    page.appendChild(inner);
    book.appendChild(page);

    enableZoom(inner, img);
  }

  const pages = document.querySelectorAll(".page");

  function showPage(n) {
    if (n < 0 || n > totalPages) return;
    current = n;

    pages.forEach((page, idx) => {
      page.classList.toggle("flipped", idx < n);
      const img = page.querySelector('img');
      resetZoom(img);
    });
  }

  document.querySelector(".nav.right").addEventListener("click", () => {
    if (current < totalPages) showPage(current + 1);
  });

  document.querySelector(".nav.left").addEventListener("click", () => {
    if (current > 0) showPage(current - 1);
  });

  toggleBtn.addEventListener("click", () => {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen().then(() => {
        book.classList.remove("normal");
        toggleBtn.textContent = "Exit Fullscreen";
      });
    } else {
      document.exitFullscreen().then(() => {
        book.classList.add("normal");
        toggleBtn.textContent = "Enter Fullscreen";
      });
    }
  });

  function setViewportHeight() {
    let vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
  }
  setViewportHeight();
  window.addEventListener('resize', setViewportHeight);

  // Enable pinch + pan + double tap zoom for each image
  function enableZoom(container, img) {
    let scale = 1;
    let startDistance = 0;
    let lastTap = 0;
    let posX = 0, posY = 0;
    let lastX = 0, lastY = 0;
    let dragging = false;

    // Double tap to toggle zoom
    container.addEventListener('touchend', (e) => {
      const currentTime = new Date().getTime();
      const tapLength = currentTime - lastTap;
      if (tapLength < 300 && tapLength > 0) {
        e.preventDefault();
        if (scale === 1) {
          scale = 2;
        } else {
          scale = 1;
          posX = posY = 0;
        }
        updateTransform();
      }
      lastTap = currentTime;
    });

    // Pinch to zoom
    container.addEventListener('touchstart', (e) => {
      if (e.touches.length === 2) {
        e.preventDefault();
        startDistance = getDistance(e.touches[0], e.touches[1]);
      } else if (e.touches.length === 1 && scale > 1) {
        dragging = true;
        lastX = e.touches[0].clientX;
        lastY = e.touches[0].clientY;
      }
    });

    container.addEventListener('touchmove', (e) => {
      if (e.touches.length === 2) {
        const currentDistance = getDistance(e.touches[0], e.touches[1]);
        let delta = currentDistance - startDistance;
        scale += delta / 300; // sensitivity
        if (scale < 1) scale = 1;
        if (scale > 4) scale = 4;
        startDistance = currentDistance;
        updateTransform();
      } else if (e.touches.length === 1 && dragging) {
        let dx = e.touches[0].clientX - lastX;
        let dy = e.touches[0].clientY - lastY;
        posX += dx;
        posY += dy;
        lastX = e.touches[0].clientX;
        lastY = e.touches[0].clientY;
        updateTransform();
      }
    });

    container.addEventListener('touchend', (e) => {
      dragging = false;
    });

    // Desktop zoom with double click
    container.addEventListener('dblclick', (e) => {
      if (scale === 1) {
        scale = 2;
      } else {
        scale = 1;
        posX = posY = 0;
      }
      updateTransform();
    });

    function updateTransform() {
      img.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
    }

    function resetZoom(image) {
      scale = 1;
      posX = posY = 0;
      image.style.transform = '';
    }
  }

  function getDistance(p1, p2) {
    return Math.hypot(p2.clientX - p1.clientX, p2.clientY - p1.clientY);
  }

  // Start on page 0
  showPage(0);
</script>
</body>
</html>
